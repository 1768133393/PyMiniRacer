steps:
- {task: UsePythonVersion@0, inputs: {versionSpec: '2.7', architecture: x64}}
- bash: echo "##vso[task.prependpath]$(Build.SourcesDirectory)\\py_mini_racer\\extension\\depot_tools\\"
- script: python setup.py build_ext
  displayName: Build the extension
- {task: UsePythonVersion@0, inputs: {versionSpec: '3.6', architecture: x64}}
- script: |
    python setup.py bdist_wheel --dist-dir wheelhouse --python-tag py2.py3 --plat-name $(plat_name)
  displayName: Build the Wheelhouse
- script: |
    pip install auditwheel
    for i in wheelhouse/*.whl; do auditwheel show $i; done
  displayName: Patch the Wheelhouse
- script: |
    pip install twine readme_renderer[md]
    twine check wheelhouse/*.whl
  displayName: Check the wheels
